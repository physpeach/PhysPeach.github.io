---
title: "ULP距離を用いる浮動小数点数の誤差評価"
date: 2023-03-07T17:19:52+09:00
description:
draft: false
categories: ["コンピュータ基礎理論"]
tags: ["ULP", "浮動小数点数", "Floating Point"]
keywords:
---

## 浮動小数点数の簡単なおさらい
主要なプログラミング言語で浮動小数点数を使うとき、IEEE754に則った形式のものを使うことになるだろう。
{{<figure src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Float_example.svg/1180px-Float_example.svg.png" alt="IEEE754準拠の32bit浮動小数点数" title="IEEE754準拠の32bit浮動小数点 from Wikipedia">}}
以下、IEEE754準拠の32bit浮動小数点を前提に話を進めるが、64bitの場合でも本質は変わらない。

### 浮動小数点数の表現方法
浮動小数点数の整数表現が$2^{31}S+2^{23}E+M$となるように符号部$S$、指数部$E$、仮数部$M$を置いた時、浮動小数点数の値$F$がどうなるかを最低限おさらいする。

#### 正規化数
まず、ほとんどの場合、浮動小数点数の値$F$は以下の式のようになる。
$$
F=(-1)^S2^{E-127}(1 + 2^{-23}M) \qquad (1 \leq E \leq 254)
$$
この式で表現される数を正規化数と呼ぶ。

$E=0, 255$の場合は後述する特別な数のために割り当てられている。

#### 非正規化数
$E=0$の時、つまり$F\sim 0$のとき、$F$は以下の式のようになる。
$$
F=(-1)^S2^{E-126}(2^{-23}M) \qquad ( E = 0)
$$
この式で表現される数を非正規化数と呼ぶ。
ポイントは正規化数で用いられていたケチビット分が

この定義により、$F=0$は$F=+0(S=0),F=-0(S=1)$の2種類の表現がある。

#### 無限大, NaN
$E=255, M=0$の場合は無限大となる。オーバーフローする計算をすることで無限大となる。

また、$E=255, M\neq0$の場合はNaNとなる。実数で表現できなくなる操作をするとNaNになる。

#### まとめ
以上をまとめると、浮動小数点数$F$は$E, M$に従って以下のように表現される。
| F | E | M |
| --- | --- | --- |
| 非正規化数 | `00000000`(2) |  |
| 正規化数 | `00000001`(2) 〜 `11111110`(2)|  |
| 無限大 | `11111111`(2) | $0$ |
| NaN | `11111111`(2) | $\neq 0$ |

## 浮動小数点数の誤差計測
### 機械イプシロン
### 相対イプシロン
### ULP距離